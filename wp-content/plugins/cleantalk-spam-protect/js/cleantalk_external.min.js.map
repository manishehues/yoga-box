{"version":3,"file":"cleantalk_external.min.js","sources":["cleantalk_external.js"],"sourcesContent":["/**\n * Handle external forms\n */\nfunction ct_protect_external() {\n    for(var i = 0; i < document.forms.length; i++) {\n\n        if (document.forms[i].cleantalk_hidden_action === undefined && document.forms[i].cleantalk_hidden_method === undefined) {\n\n            // current form\n            var currentForm = document.forms[i];\n\n            if(typeof(currentForm.action) == 'string') {\n\n                if(isIntegratedForm(currentForm)) {\n                    jQuery( currentForm ).before('<i class=\"cleantalk_placeholder\" style=\"display: none;\"></i>');\n\n                    // Deleting form to prevent submit event\n                    var prev = jQuery(currentForm).prev(),\n                        form_html = currentForm.outerHTML,\n                        form_original = jQuery(currentForm).detach();\n\n                    prev.after( form_html );\n\n                    var force_action = document.createElement(\"input\");\n                    force_action.name = 'action';\n                    force_action.value = 'cleantalk_force_ajax_check';\n                    force_action.type = 'hidden';\n\n                    var reUseCurrentForm = document.forms[i];\n\n                    reUseCurrentForm.appendChild(force_action);\n\n                    // mailerlite integration - disable click on submit button\n                    if(reUseCurrentForm.classList !== undefined && reUseCurrentForm.classList.contains('ml-block-form')) {\n                        var mailerliteSubmitButton = jQuery('form.ml-block-form').find('button[type=\"submit\"]');\n\n                        if(mailerliteSubmitButton !== undefined) {\n                            mailerliteSubmitButton.click(function (event) {\n                                event.preventDefault();\n                                sendAjaxCheckingFormData(reUseCurrentForm, prev, form_original);\n                            });\n                        }\n                    } else {\n                        document.forms[i].onsubmit = function ( event ){\n\n                            event.preventDefault();\n\n                            sendAjaxCheckingFormData(reUseCurrentForm, prev, form_original);\n                        };\n                    }\n\n                    // Common flow\n                }else if(currentForm.action.indexOf('http://') !== -1 || currentForm.action.indexOf('https://') !== -1) {\n\n                    var tmp = currentForm.action.split('//');\n                    tmp = tmp[1].split('/');\n                    var host = tmp[0].toLowerCase();\n\n                    if(host !== location.hostname.toLowerCase()){\n\n                        var ct_action = document.createElement(\"input\");\n                        ct_action.name = 'cleantalk_hidden_action';\n                        ct_action.value = currentForm.action;\n                        ct_action.type = 'hidden';\n                        currentForm.appendChild(ct_action);\n\n                        var ct_method = document.createElement(\"input\");\n                        ct_method.name = 'cleantalk_hidden_method';\n                        ct_method.value = currentForm.method;\n                        ct_method.type = 'hidden';\n\n                        currentForm.method = 'POST';\n                        currentForm.appendChild(ct_method);\n\n                        currentForm.action = document.location;\n                    }\n                }\n            }\n        }\n\n    }\n}\nfunction apbct_replace_inputs_values_from_other_form( form_source, form_target ){\n\n    var\tinputs_source = jQuery( form_source ).find( 'button, input, textarea, select' ),\n        inputs_target = jQuery( form_target ).find( 'button, input, textarea, select' );\n\n    inputs_source.each( function( index, elem_source ){\n\n        var source = jQuery( elem_source );\n\n        inputs_target.each( function( index2, elem_target ){\n\n            var target = jQuery( elem_target );\n\n            if( elem_source.outerHTML === elem_target.outerHTML ){\n\n                target.val( source.val() );\n            }\n        });\n    });\n\n}\nwindow.onload = function () {\n    setTimeout(function () {\n        ct_protect_external()\n    }, 1500);\n};\n\n/**\n * Checking the form integration\n */\nfunction isIntegratedForm(formObj) {\n    var formAction = formObj.action;\n\n    if(\n        formAction.indexOf('activehosted.com') !== -1 ||   // ActiveCampaign form\n        formAction.indexOf('app.convertkit.com') !== -1 || // ConvertKit form\n        ( formObj.firstChild.classList !== undefined && formObj.firstChild.classList.contains('cb-form-group') ) || // Convertbox form\n        formAction.indexOf('mailerlite.com') !== -1 // Mailerlite integration\n    ) {\n        return true;\n    }\n\n    return false;\n}\n\n/**\n * Sending Ajax for checking form data\n */\nfunction sendAjaxCheckingFormData(form, prev, formOriginal) {\n    // Get visible fields and set cookie\n    var visible_fields = {};\n    visible_fields[0] = apbct_collect_visible_fields(form);\n    apbct_visible_fields_set_cookie( visible_fields );\n\n    var data = {};\n    var elems = form.elements;\n    elems = Array.prototype.slice.call(elems);\n\n    elems.forEach( function( elem, y ) {\n        if( elem.name === '' ) {\n            data['input_' + y] = elem.value;\n        } else {\n            data[elem.name] = elem.value;\n        }\n    });\n\n    apbct_public_sendAJAX(\n        data,\n        {\n            async: false,\n            callback: function( prev, formOriginal, result ){\n\n                if( ! +result.apbct.blocked ) {\n\n                    var form_new = jQuery(form).detach();\n\n                    apbct_replace_inputs_values_from_other_form(form_new, formOriginal);\n\n                    prev.after( formOriginal );\n\n                    // Common click event\n                    var subm_button = jQuery(formOriginal).find('button[type=submit]');\n                    if( subm_button.length !== 0 ) {\n                        subm_button[0].click();\n                    }\n\n                    // ConvertKit direct integration\n                    subm_button = jQuery(formOriginal).find('button[data-element=\"submit\"]');\n                    if( subm_button.length !== 0 ) {\n                        subm_button[0].click();\n                    }\n\n                }\n            },\n            callback_context: null,\n            callback_params: [prev, formOriginal],\n        }\n    );\n}\n"],"names":["ct_protect_external","currentForm","prev","form_html","form_original","force_action","reUseCurrentForm","mailerliteSubmitButton","ct_action","ct_method","i","document","forms","length","undefined","cleantalk_hidden_action","cleantalk_hidden_method","isIntegratedForm","jQuery","before","outerHTML","detach","after","createElement","name","value","type","appendChild","classList","contains","find","click","event","preventDefault","sendAjaxCheckingFormData","onsubmit","action","indexOf","split","toLowerCase","location","hostname","method","apbct_replace_inputs_values_from_other_form","form_source","form_target","inputs_source","inputs_target","each","index","elem_source","source","index2","elem_target","target","val","formObj","formAction","firstChild","form","formOriginal","visible_fields","apbct_collect_visible_fields","apbct_visible_fields_set_cookie","data","elems","elements","Array","prototype","slice","call","forEach","elem","y","apbct_public_sendAJAX","async","callback","result","subm_button","apbct","blocked","callback_context","callback_params","window","onload","setTimeout"],"mappings":"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"}